fragment CheckoutProduct on ProductVariant {
  product {
    id
    name
    slug
  }
}

fragment GenericShippingMethod on ShippingMethod {
  id
  name
  description
  active
  minimumOrderPrice {
    amount
    currency
  }
  maximumOrderPrice {
    amount
    currency
  }
  price {
    amount
    currency
  }
  minimumDeliveryDays
  maximumDeliveryDays

  minimumOrderWeight {
    unit
    value
  }

  maximumOrderWeight {
    unit
    value
  }
}

fragment GenericCheckoutInfo on Checkout {
  token
  email

  lines {
    id
    quantity
    variant {
      ...GenericProductVariant
      ...CheckoutProduct
    }
  }

  subtotalPrice {
    gross {
      amount
      currency
    }
  }

  shippingPrice {
    gross {
      amount
      currency
    }
  }

  totalPrice {
    gross {
      amount
      currency
    }
  }

  shippingAddress {
    ...GenericAddress
  }

  billingAddress {
    ...GenericAddress
  }

  shippingMethods {
    ...GenericShippingMethod
  }

  deliveryMethod {
    ...GenericShippingMethod
  }
}

query GetCheckoutInfo($checkoutToken: UUID!) {
  checkout(token: $checkoutToken) {
    ...GenericCheckoutInfo
  }
}

mutation CreateCheckout($channel: String!, $email: String!) {
  checkoutCreate(input: { channel: $channel, email: $email, lines: [] }) {
    checkout {
      ...GenericCheckoutInfo
    }
    errors {
      code
      message
      field
    }
  }
}

mutation AddProductToCart($checkoutToken: UUID!, $variantId: ID!) {
  checkoutLinesAdd(
    token: $checkoutToken
    lines: [{ quantity: 1, variantId: $variantId }]
  ) {
    checkout {
      ...GenericCheckoutInfo
    }
    errors {
      code
      message
      field
    }
  }
}

mutation UpdateProductInCart(
  $checkoutToken: UUID!
  $lines: [CheckoutLineUpdateInput!]!
) {
  checkoutLinesUpdate(token: $checkoutToken, lines: $lines) {
    checkout {
      ...GenericCheckoutInfo
    }
    errors {
      code
      message
      field
    }
  }
}

mutation RemoveProductFromCart($checkoutToken: UUID!, $linesIds: [ID!]!) {
  checkoutLinesDelete(token: $checkoutToken, linesIds: $linesIds) {
    checkout {
      ...GenericCheckoutInfo
    }
    errors {
      code
      message
      field
    }
  }
}

mutation UpdateCheckoutShippingAddress(
  $checkoutToken: UUID!
  $address: AddressInput!
) {
  checkoutShippingAddressUpdate(
    token: $checkoutToken
    shippingAddress: $address
  ) {
    checkout {
      ...GenericCheckoutInfo
    }
    errors {
      code
      message
      field
    }
  }
}

mutation UpdateCheckoutBillingAddress(
  $checkoutToken: UUID!
  $address: AddressInput!
) {
  checkoutBillingAddressUpdate(
    token: $checkoutToken
    billingAddress: $address
  ) {
    checkout {
      ...GenericCheckoutInfo
    }
    errors {
      code
      message
      field
    }
  }
}

mutation UpdateCheckoutEmail($checkoutToken: UUID!, $email: String!) {
  checkoutEmailUpdate(token: $checkoutToken, email: $email) {
    checkout {
      ...GenericCheckoutInfo
    }
    errors {
      code
      message
      field
    }
  }
}
